<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì∫ Projector View - QuizMaster Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --pastel-pink: #FFB3D9;
            --pastel-blue: #B3D9FF;
            --pastel-green: #B3FFD9;
            --pastel-yellow: #FFD9B3;
            --pastel-purple: #D9B3FF;
            --pastel-coral: #FFB3B3;
        }
        
        * { font-family: 'Poppins', sans-serif; }
        
        body {
            background: linear-gradient(135deg, 
                var(--pastel-purple) 0%, 
                var(--pastel-pink) 25%, 
                var(--pastel-blue) 50%, 
                var(--pastel-green) 75%, 
                var(--pastel-yellow) 100%);
            background-size: 500% 500%;
            animation: gradientShift 25s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .mega-timer {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--pastel-green), var(--pastel-yellow), var(--pastel-coral));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: timerRotate 2s linear infinite;
        }
        
        .mega-timer.warning {
            animation: timerPulse 0.3s ease-in-out infinite;
        }
        
        @keyframes timerRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .timer-inner {
            width: 160px;
            height: 160px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            font-weight: 900;
            color: #374151;
            box-shadow: inset 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-item {
            animation: slideInRight 0.8s ease-out;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .leaderboard-item:hover {
            transform: translateX(-10px) scale(1.02);
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .question-display {
            animation: questionZoom 1s ease-out;
        }
        
        @keyframes questionZoom {
            0% { opacity: 0; transform: scale(0.8); }
            60% { transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .option-reveal {
            animation: optionPop 0.6s ease-out;
        }
        
        @keyframes optionPop {
            0% { opacity: 0; transform: translateY(30px) scale(0.9); }
            70% { transform: translateY(-5px) scale(1.02); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .correct-answer {
            background: linear-gradient(45deg, var(--pastel-green), #4ade80);
            animation: correctGlow 1s ease-out;
            border: 3px solid #22c55e;
        }
        
        @keyframes correctGlow {
            0% { box-shadow: 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { box-shadow: 0 0 40px rgba(34, 197, 94, 0.7); }
            100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .floating-emoji {
            animation: float 4s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }
        
        .mega-title {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(45deg, #8b5cf6, #ec4899, #3b82f6, #10b981);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShimmer 3s ease-in-out infinite;
        }
        
        @keyframes titleShimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .player-avatar-large {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--pastel-pink), var(--pastel-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            border: 3px solid white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .rank-crown {
            font-size: 2rem;
            animation: crownBounce 2s ease-in-out infinite;
        }
        
        @keyframes crownBounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .waiting-pulse {
            animation: waitingPulse 2s ease-in-out infinite;
        }
        
        @keyframes waitingPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        
        .room-code-mega {
            font-size: 6rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--pastel-yellow), var(--pastel-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            animation: codeGlow 3s ease-in-out infinite;
        }
        
        @keyframes codeGlow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.3)); }
            50% { filter: drop-shadow(0 0 40px rgba(255, 215, 0, 0.6)); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="glass-card mx-6 mt-6 rounded-3xl p-6">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <div class="text-5xl floating-emoji">üì∫</div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Projector View</h1>
                    <p class="text-gray-600 text-lg">Live Quiz Display</p>
                </div>
            </div>
            
            <div class="flex items-center space-x-8">
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-800" id="live-players">0</div>
                    <div class="text-gray-600">Players</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-800" id="live-questions">0</div>
                    <div class="text-gray-600">Questions</div>
                </div>
                <button onclick="goHome()" class="px-6 py-3 bg-white/30 hover:bg-white/40 rounded-2xl text-gray-700 font-medium transition-all">
                    üè† Home
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Room Connection -->
        <div id="connection-section" class="text-center mb-8">
            <div class="glass-card rounded-3xl p-12 max-w-2xl mx-auto">
                <div class="text-8xl mb-6 waiting-pulse">üîó</div>
                <h2 class="text-4xl font-bold text-gray-800 mb-6">Connect to Quiz Room</h2>
                
                <div class="flex flex-col md:flex-row gap-4 max-w-md mx-auto mb-8">
                    <input type="text" id="projector-room-code" placeholder="Room Code" 
                           class="flex-1 px-6 py-4 rounded-2xl border-2 border-white/30 bg-white/20 backdrop-blur-sm text-gray-800 placeholder-gray-600 font-medium text-center text-xl focus:outline-none focus:border-purple-400"
                           maxlength="6">
                    <button onclick="connectToRoom()" 
                            class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-8 rounded-2xl text-xl transition-all transform hover:scale-105">
                        üì° Connect
                    </button>
                </div>
                
                <p class="text-gray-600 text-lg">Enter the room code to display the quiz for your audience</p>
            </div>
        </div>

        <!-- Waiting Screen -->
        <div id="waiting-section" class="hidden text-center">
            <div class="glass-card rounded-3xl p-16 mb-8">
                <div class="room-code-mega mb-8" id="display-room-code">ABCD</div>
                <h2 class="mega-title mb-8">Get Ready to Quiz!</h2>
                <div class="text-2xl text-gray-700 mb-12">Waiting for the host to start the quiz...</div>
                
                <div class="grid md:grid-cols-4 gap-8">
                    <div class="stats-card rounded-2xl p-6 text-center">
                        <div class="text-4xl mb-3 floating-emoji">üë•</div>
                        <div class="text-3xl font-bold text-gray-800" id="waiting-player-count">0</div>
                        <div class="text-gray-600 text-lg">Players Joined</div>
                    </div>
                    <div class="stats-card rounded-2xl p-6 text-center">
                        <div class="text-4xl mb-3 floating-emoji" style="animation-delay: 0.5s;">‚ùì</div>
                        <div class="text-3xl font-bold text-gray-800" id="waiting-question-count">0</div>
                        <div class="text-gray-600 text-lg">Total Questions</div>
                    </div>
                    <div class="stats-card rounded-2xl p-6 text-center">
                        <div class="text-4xl mb-3 floating-emoji" style="animation-delay: 1s;">‚è±Ô∏è</div>
                        <div class="text-3xl font-bold text-gray-800" id="waiting-timer-setting">15s</div>
                        <div class="text-gray-600 text-lg">Per Question</div>
                    </div>
                    <div class="stats-card rounded-2xl p-6 text-center">
                        <div class="text-4xl mb-3 floating-emoji" style="animation-delay: 1.5s;">üèÜ</div>
                        <div class="text-3xl font-bold text-gray-800">Live</div>
                        <div class="text-gray-600 text-lg">Leaderboard</div>
                    </div>
                </div>
            </div>
            
            <!-- Live Player List -->
            <div class="glass-card rounded-3xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">üë• Players in Lobby</h3>
                <div id="lobby-players" class="grid md:grid-cols-6 gap-4">
                    <div class="text-center text-gray-500 col-span-6 py-8">
                        <div class="text-4xl mb-2">üëª</div>
                        <p>Waiting for players to join...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-section" class="hidden">
            <!-- Question Header -->
            <div class="glass-card rounded-3xl p-8 mb-8">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-6">
                        <div class="mega-timer" id="mega-timer">
                            <div class="timer-inner" id="mega-timer-display">15</div>
                        </div>
                        <div>
                            <div class="text-2xl text-gray-600">Question <span id="current-q-num">1</span> of <span id="total-q-num">10</span></div>
                            <div class="w-96 bg-white/30 rounded-full h-4 mt-2">
                                <div class="bg-gradient-to-r from-purple-400 to-pink-400 h-4 rounded-full transition-all duration-500" 
                                     id="mega-progress" style="width: 10%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-right">
                        <div class="text-3xl font-bold text-gray-800" id="answered-count">0</div>
                        <div class="text-gray-600 text-lg">Answered</div>
                    </div>
                </div>
            </div>

            <!-- Question Display -->
            <div class="glass-card rounded-3xl p-12 mb-8 question-display" id="question-display">
                <h2 class="text-5xl font-bold text-gray-800 text-center mb-12" id="mega-question-text">
                    Question will appear here...
                </h2>
                
                <div class="grid md:grid-cols-2 gap-8" id="mega-options">
                    <!-- Options will be populated here -->
                </div>
            </div>

            <!-- Live Stats -->
            <div class="grid md:grid-cols-4 gap-6">
                <div class="stats-card rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-3">‚ö°</div>
                    <div class="text-2xl font-bold text-gray-800" id="avg-response-time">--</div>
                    <div class="text-gray-600">Avg Response</div>
                </div>
                <div class="stats-card rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-3">üéØ</div>
                    <div class="text-2xl font-bold text-gray-800" id="accuracy-rate">--%</div>
                    <div class="text-gray-600">Accuracy</div>
                </div>
                <div class="stats-card rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-3">üî•</div>
                    <div class="text-2xl font-bold text-gray-800" id="participation-rate">--%</div>
                    <div class="text-gray-600">Participation</div>
                </div>
                <div class="stats-card rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-3">üëë</div>
                    <div class="text-xl font-bold text-gray-800" id="current-leader">--</div>
                    <div class="text-gray-600">Current Leader</div>
                </div>
            </div>
        </div>

        <!-- Leaderboard Screen -->
        <div id="leaderboard-section" class="hidden">
            <div class="glass-card rounded-3xl p-12 text-center mb-8">
                <h2 class="mega-title mb-8">üèÜ Leaderboard</h2>
                <div class="text-2xl text-gray-700 mb-8">Current Rankings</div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Top 3 Podium -->
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">ü•á Top 3</h3>
                    <div id="podium" class="space-y-4">
                        <!-- Podium will be populated here -->
                    </div>
                </div>
                
                <!-- Full Rankings -->
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">üìä All Players</h3>
                    <div id="full-rankings" class="space-y-3 max-h-96 overflow-y-auto">
                        <!-- Rankings will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-section" class="hidden text-center">
            <div class="glass-card rounded-3xl p-16">
                <div class="text-8xl mb-8 floating-emoji">üéâ</div>
                <h2 class="mega-title mb-8">Quiz Complete!</h2>
                <div class="text-3xl text-gray-700 mb-12">Congratulations to all participants!</div>
                
                <!-- Final Podium -->
                <div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto" id="final-podium">
                    <!-- Final podium will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let socket;
        let roomCode = null;
        let currentRoom = null;
        let timer = 0;
        let timerInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initSocket();
            setupEventListeners();
        });

        function initSocket() {
            socket = io();
            
            socket.on('connect', () => {
                console.log('üü¢ Connected to server');
            });
            
            socket.on('state', (roomState) => {
                currentRoom = roomState;
                updateDisplay(roomState);
            });
            
            socket.on('roundStarted', (data) => {
                showQuizSection();
                if (data.question) {
                    displayQuestion(data.question, data.idx);
                }
            });
            
            socket.on('questionShown', (data) => {
                displayQuestion(data.question, data.idx);
                startMegaTimer(data.timer || 15);
            });
            
            socket.on('questionChanged', (data) => {
                displayQuestion(data.question, data.idx);
                startMegaTimer(data.timer || 15);
            });
            
            socket.on('answerResults', (data) => {
                showAnswerResults(data.perPlayer);
            });
            
            socket.on('leaderboard', (data) => {
                showLeaderboard(data.leaderboard);
            });
            
            socket.on('roundEnded', () => {
                showResultsSection();
            });
            
            socket.on('playerAnsweredLive', (data) => {
                updateAnsweredCount();
            });
        }

        function setupEventListeners() {
            document.getElementById('projector-room-code').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    connectToRoom();
                }
            });
            
            document.getElementById('projector-room-code').addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase();
            });
        }

        function connectToRoom() {
            const code = document.getElementById('projector-room-code').value.trim().toUpperCase();
            
            if (!code) {
                showNotification('Please enter a room code!', 'error');
                return;
            }
            
            roomCode = code;
            
            // Join as observer
            socket.emit('hostJoin', { code: code });
            
            // Show waiting section
            document.getElementById('connection-section').classList.add('hidden');
            document.getElementById('waiting-section').classList.remove('hidden');
            document.getElementById('display-room-code').textContent = code;
            
            showNotification('Connected to room!', 'success');
        }

        function updateDisplay(roomState) {
            if (!roomState) return;
            
            const playerCount = Object.keys(roomState.players || {}).length;
            
            // Update header stats
            document.getElementById('live-players').textContent = playerCount;
            document.getElementById('live-questions').textContent = roomState.totalQuestions || 0;
            
            // Update waiting screen
            document.getElementById('waiting-player-count').textContent = playerCount;
            document.getElementById('waiting-question-count').textContent = roomState.totalQuestions || 0;
            document.getElementById('waiting-timer-setting').textContent = (roomState.autoQuestionTimer || 15) + 's';
            
            // Update lobby players
            updateLobbyPlayers(roomState.players || {});
            
            // Update quiz stats if active
            if (roomState.roundActive) {
                updateQuizStats(roomState);
            }
        }

        function updateLobbyPlayers(players) {
            const lobbyContainer = document.getElementById('lobby-players');
            
            if (Object.keys(players).length === 0) {
                lobbyContainer.innerHTML = `
                    <div class="text-center text-gray-500 col-span-6 py-8">
                        <div class="text-4xl mb-2">üëª</div>
                        <p>Waiting for players to join...</p>
                    </div>
                `;
                return;
            }
            
            lobbyContainer.innerHTML = '';
            Object.values(players).forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'stats-card rounded-2xl p-4 text-center';
                playerDiv.style.animationDelay = `${index * 0.1}s`;
                
                const avatar = player.avatar || player.name.charAt(0).toUpperCase();
                
                playerDiv.innerHTML = `
                    <div class="player-avatar-large mx-auto mb-3">${avatar}</div>
                    <div class="font-semibold text-gray-800 text-sm">${player.name}</div>
                    <div class="text-xs text-gray-600">Ready</div>
                `;
                
                lobbyContainer.appendChild(playerDiv);
            });
        }

        function showQuizSection() {
            document.getElementById('waiting-section').classList.add('hidden');
            document.getElementById('quiz-section').classList.remove('hidden');
            document.getElementById('leaderboard-section').classList.add('hidden');
            document.getElementById('results-section').classList.add('hidden');
        }

        function showLeaderboard(leaderboard) {
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('leaderboard-section').classList.remove('hidden');
            
            updatePodium(leaderboard);
            updateFullRankings(leaderboard);
        }

        function showResultsSection() {
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('leaderboard-section').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            
            if (currentRoom) {
                const players = Object.values(currentRoom.players || {});
                const sortedPlayers = players.sort((a, b) => (b.score || 0) - (a.score || 0));
                updateFinalPodium(sortedPlayers);
            }
        }

        function displayQuestion(question, index) {
            if (!question) return;
            
            // Update question info
            document.getElementById('current-q-num').textContent = index + 1;
            document.getElementById('total-q-num').textContent = currentRoom?.totalQuestions || 10;
            document.getElementById('mega-question-text').textContent = question.question;
            
            // Update progress
            const progress = ((index + 1) / (currentRoom?.totalQuestions || 10)) * 100;
            document.getElementById('mega-progress').style.width = progress + '%';
            
            // Create mega options
            const optionsContainer = document.getElementById('mega-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'glass-card p-8 rounded-2xl text-center option-reveal';
                optionDiv.style.animationDelay = `${i * 0.2}s`;
                
                optionDiv.innerHTML = `
                    <div class="flex items-center justify-center space-x-4">
                        <div class="w-16 h-16 bg-white/50 rounded-full flex items-center justify-center text-2xl font-bold">
                            ${String.fromCharCode(65 + i)}
                        </div>
                        <div class="text-2xl font-semibold text-gray-800">${option}</div>
                    </div>
                `;
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // Reset answered count
            document.getElementById('answered-count').textContent = '0';
        }

        function showAnswerResults(perPlayer) {
            if (!currentRoom || !currentRoom.questions) return;
            
            const currentQuestion = currentRoom.questions[currentRoom.currentQuestionIndex];
            if (!currentQuestion) return;
            
            const correctIndex = currentQuestion.correct;
            
            // Highlight correct answer
            const options = document.querySelectorAll('#mega-options > div');
            options.forEach((option, index) => {
                if (index === correctIndex) {
                    option.classList.add('correct-answer');
                }
            });
            
            // Update stats
            updateAnswerStats(perPlayer);
        }

        function updateAnswerStats(perPlayer) {
            const totalPlayers = Object.keys(currentRoom?.players || {}).length;
            const answeredPlayers = Object.keys(perPlayer).length;
            const correctAnswers = Object.values(perPlayer).filter(p => p.correct).length;
            
            document.getElementById('answered-count').textContent = answeredPlayers;
            document.getElementById('participation-rate').textContent = 
                totalPlayers > 0 ? Math.round((answeredPlayers / totalPlayers) * 100) + '%' : '0%';
            document.getElementById('accuracy-rate').textContent = 
                answeredPlayers > 0 ? Math.round((correctAnswers / answeredPlayers) * 100) + '%' : '0%';
        }

        function updateQuizStats(roomState) {
            // Update current leader
            const players = Object.values(roomState.players || {});
            const sortedPlayers = players.sort((a, b) => (b.score || 0) - (a.score || 0));
            
            if (sortedPlayers.length > 0) {
                document.getElementById('current-leader').textContent = sortedPlayers[0].name;
            }
        }

        function updateAnsweredCount() {
            const current = parseInt(document.getElementById('answered-count').textContent) || 0;
            document.getElementById('answered-count').textContent = current + 1;
        }

        function updatePodium(leaderboard) {
            const podiumContainer = document.getElementById('podium');
            podiumContainer.innerHTML = '';
            
            const top3 = leaderboard.slice(0, 3);
            
            top3.forEach((player, index) => {
                const podiumDiv = document.createElement('div');
                podiumDiv.className = 'leaderboard-item flex items-center justify-between p-6 bg-white/20 rounded-2xl';
                podiumDiv.style.animationDelay = `${index * 0.2}s`;
                
                let crown = '';
                if (index === 0) crown = 'üëë';
                else if (index === 1) crown = 'ü•à';
                else if (index === 2) crown = 'ü•â';
                
                const avatar = player.avatar || player.name.charAt(0).toUpperCase();
                
                podiumDiv.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="rank-crown">${crown}</div>
                        <div class="player-avatar-large">${avatar}</div>
                        <div>
                            <div class="text-xl font-bold text-gray-800">${player.name}</div>
                            <div class="text-gray-600">Rank #${index + 1}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold text-gray-800">${player.score || 0}</div>
                        <div class="text-gray-600">points</div>
                    </div>
                `;
                
                podiumContainer.appendChild(podiumDiv);
            });
        }

        function updateFullRankings(leaderboard) {
            const rankingsContainer = document.getElementById('full-rankings');
            rankingsContainer.innerHTML = '';
            
            leaderboard.forEach((player, index) => {
                const rankDiv = document.createElement('div');
                rankDiv.className = 'leaderboard-item flex items-center justify-between p-4 bg-white/20 rounded-xl';
                rankDiv.style.animationDelay = `${index * 0.1}s`;
                
                const avatar = player.avatar || player.name.charAt(0).toUpperCase();
                
                rankDiv.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-lg font-bold text-gray-700">#${index + 1}</div>
                        <div class="player-avatar-large">${avatar}</div>
                        <div class="font-semibold text-gray-800">${player.name}</div>
                    </div>
                    <div class="text-xl font-bold text-gray-800">${player.score || 0}</div>
                `;
                
                rankingsContainer.appendChild(rankDiv);
            });
        }

        function updateFinalPodium(players) {
            const podiumContainer = document.getElementById('final-podium');
            podiumContainer.innerHTML = '';
            
            const top3 = players.slice(0, 3);
            const positions = [1, 0, 2]; // Second, First, Third for visual effect
            
            positions.forEach((pos, visualIndex) => {
                if (pos >= top3.length) return;
                
                const player = top3[pos];
                const podiumDiv = document.createElement('div');
                
                let height = '';
                let crown = '';
                
                if (pos === 0) {
                    height = 'h-64';
                    crown = 'üëë';
                } else if (pos === 1) {
                    height = 'h-48';
                    crown = 'ü•à';
                } else {
                    height = 'h-32';
                    crown = 'ü•â';
                }
                
                podiumDiv.className = `glass-card rounded-2xl p-6 text-center ${height} flex flex-col justify-end`;
                
                const avatar = player.avatar || player.name.charAt(0).toUpperCase();
                
                podiumDiv.innerHTML = `
                    <div class="text-4xl mb-2">${crown}</div>
                    <div class="player-avatar-large mx-auto mb-3">${avatar}</div>
                    <div class="text-xl font-bold text-gray-800 mb-1">${player.name}</div>
                    <div class="text-3xl font-bold text-purple-600">${player.score || 0}</div>
                    <div class="text-gray-600">points</div>
                `;
                
                podiumContainer.appendChild(podiumDiv);
            });
        }

        function startMegaTimer(seconds) {
            clearInterval(timerInterval);
            timer = seconds;
            
            const timerDisplay = document.getElementById('mega-timer-display');
            const timerCircle = document.getElementById('mega-timer');
            
            timerDisplay.textContent = timer;
            
            timerInterval = setInterval(() => {
                timer--;
                timerDisplay.textContent = timer;
                
                if (timer <= 5) {
                    timerCircle.classList.add('warning');
                } else {
                    timerCircle.classList.remove('warning');
                }
                
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    timerCircle.classList.remove('warning');
                }
            }, 1000);
        }

        function goHome() {
            window.location.href = '/';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 z-50 p-4 rounded-2xl font-medium transform transition-all duration-300 translate-x-full`;
            
            switch(type) {
                case 'success':
                    notification.className += ' bg-green-100 text-green-800 border border-green-200';
                    break;
                case 'error':
                    notification.className += ' bg-red-100 text-red-800 border border-red-200';
                    break;
                default:
                    notification.className += ' bg-blue-100 text-blue-800 border border-blue-200';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e074351466a7df',t:'MTc1NzY5MTExMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
